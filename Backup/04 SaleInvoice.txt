;;;Shivgoraksh
;
;;;; Shivgoraksh
;
;[Variable: SalesLV]
;	
;	Type: String
;
;[#Menu: Gateway of Tally]
;	
;	Add: Item: ERPNextSales  : Call: ERPNextSales
;	
;	[Function: ERPNextSales]
;		
;		List Variable: SalesLV
;
;		12 : Delete File: "STSales.xml"
;		13 : Open File: "STSales.xml" : Text : Write
;		14 : Truncate File
;
;		16 : Walk Collection: ERPNextSalesColl
;		18 : Call: SalesXML
;		152 : List Add: SalesLV : $name : $name		
;		155 : End Walk
;
;		200 : Close Target File
;		210 : SET : IMPORT File : "STSales.xml" 	
;		220 : Import : All Masters : Yes
;
;		230 : If : Not $$ImportInfo:Errors > 0		
;		240 : 	Call : UpdateSalesStatus:($$NumItems:CustomerLVColl)
;		242 : else
;		245 : Msg Box: "Error" : "Something Went Wrong, Please contact support"
;		250 : End If
;
;
;	[System: Formula]
;		
;		
;[Collection: ERPNextSalesColl]
;	
;	Export Header	: "Accept: application/json"
;	Export Header	: "Accept-Charset: utf-8"
;	Export Header	: "Authorization: " + "token " + @@AuthToken
;
;	Data Source: HTTP JSON : @@ERPNextHost + '/api/method/tally_integration.tally.sales'
;	RemoteRequest: SalesReq : UTF8
;	JSON Object : ERPNextSales
;	JSON Object Path: "message:1"
;	
;
;	[Object: ERPNextSales]
;		
;		Storage : name 			: String
;		Storage : supplier		: String
;		Storage : supplier_name	: String
;		Storage : posting_date  : String
;		Storage : base_rounded_total 	: Number
;		Storage: is_return : Number
;		
;		collection : tSalesinvoice : tSalesinvoice
;		
;		[Object: tSalesinvoice]
;			
;			Collection: items : items
;			Collection: taxes : taxes
;			
;		[Object: items]
;			
;			Storage: item_code : String
;			Storage: rate	 : Number
;			Storage: uom	 : String
;			Storage: amount	 : Number
;			Storage: qty	 : Number
;			Storage: warehouse	 : String
;			Storage: item_group	 : String
;
;		[Object: taxes]
;			
;			Storage: account_head	: String
;			Storage: tax_amount_after_discount_amount : Number
;
;;; Request Report 
;
;	[Report: SalesReq]
;		
;		Form: SalesReq
;		
;		[Form: SalesReq]
;			
;			Part: SalesReq
;			Delete: XMLTag
;
;			[Part: SalesReq]
;					
;				Line: SalesReq
;				Scroll: Vertical
;
;				[Line: SalesReq]
;					
;					Field: SalesReqBranch, SalesReqSyncFrom
;					;XMLTag: "request"
;					
;				[Field: SalesReqBranch]
;					
;					XMLTag: "company"
;					Set as: @@ERPNextBranch
;					
;				[Field: SalesReqSyncFrom]
;					
;					XMLTag: "date"
;					Set as: "2021-04-01" ; @@ERPNextLastSyncOn
;					
;;; End of Request Report
;
;
;
;;; Master Success 
;
;[Function: UpdateSalesStatus]
;	
;	Parameter: processedIds : Number
;
;	08 : If: ##processedIds > 0 
;	10 : Walk Collection: UpdateSalesColl
;	20 : End Walk
;	30 : End If
;	40 : Delete File: "STSales.xml"
;
;
;
;
;[Collection: UpdateSalesColl]
;	
;	Export Header	: "Accept: application/json"
;	Export Header	: "Accept-Charset: utf-8"
;	Export Header	: "Authorization: " + "token " + @@AuthToken
;
;	Data Source	 : HTTP JSON: @@ERPNextHost + '/api/method/tally_integration.tally.customer_update'
;	RemoteRequest : UpdateSalesRep : UTF8
;
;;; Status Report 
;
;[Report: UpdateSalesRep]
;	
;	Form: UpdateSalesRep
;	
;	[Form: UpdateSalesRep]
;		
;		Part: UpdateSalesRep
;		Delete: XMLTag
;
;	[Part: UpdateSalesRep]
;		
;		Line: UpdateSalesRep
;		Scroll: Vertical
;		
;	[Line: UpdateSalesRep]
;		
;		Field: UpdateSalesRep
;		Explode: UpdateSalesRepExp
;		
;			[Part: UpdateSalesRepExp]
;				
;				Line: UpdateSalesRepExp
;				Repeat: UpdateSalesRepExp : SalesLVColl
;				
;				[Line: UpdateSalesRepExp]
;					
;					Field: UpdateSalesRepExp
;					JSONTag: "data"
;					
;					[Field:UpdateSalesRepExp]
;						
;						Set as: $SalesLV
;						XMLTag: "docname"
;		
;		[Field: UpdateSalesRep]
;			
;			Set as: "Sales Invoice"
;			JSONTag: "request_type"
;	
;	[Collection: SalesLVColl]
;		
;		Data Source: Variable: SalesLV 
;
;
;
;;;;; Purchase XMl
;
;[Function: SalesXML]
;	
;Variable: is_return : Number: $$Number:$is_return
;
;10	:	Write File Line : 	'	    <TALLYMESSAGE xmlns:UDF="TallyUDF">'
;20	:	Write File Line : 	'	     <VOUCHER REMOTEID="'+$name+'" VCHTYPE="'+@@PIVoucherType+'" ACTION="Create" OBJVIEW="Invoice Voucher View">'
;30	:	Write File Line : 	'	      <ADDRESS.LIST TYPE="String">'
;40	:	Do If: Not ($$IsEmpty:$_address1:Ledger:$supplier_name) : Write File Line : 	'	       <ADDRESS>'+$_address1:Ledger:$supplier_name+'</ADDRESS>'
;50	:	Do If: Not ($$IsEmpty:$_address2:Ledger:$supplier_name) : Write File Line : 	'	       <ADDRESS>'+$_address2:Ledger:$supplier_name+'</ADDRESS>'
;60	:	Do If: Not ($$IsEmpty:$_address3:Ledger:$supplier_name) : Write File Line : 	'	       <ADDRESS>'+$_address3:Ledger:$supplier_name+'</ADDRESS>'
;62	:	Do If: Not ($$IsEmpty:$_address4:Ledger:$supplier_name) : Write File Line : 	'	       <ADDRESS>'+$_address4:Ledger:$supplier_name+'</ADDRESS>'
;70	:	Write File Line : 	'	      </ADDRESS.LIST>'
;80	:	Write File Line : 	'	      <DATE>'+$$GetTallyDate:$posting_date+'</DATE>'
;90	:	Write File Line : 	'	      <GSTREGISTRATIONTYPE>'+$GSTREGISTRATIONTYPE:Ledger:$supplier_name+'</GSTREGISTRATIONTYPE>'
;100	:	Write File Line : 	'	      <STATENAME>'+$LedStateName:Ledger:$supplier_name+'</STATENAME>'
;110	:	Write File Line : 	'	      <COUNTRYOFRESIDENCE>'+$CountryName:Ledger:$supplier_name+'</COUNTRYOFRESIDENCE>'
;120	:	Write File Line : 	'	      <PARTYGSTIN>'+$PartyGstin:Ledger:$supplier_name+'</PARTYGSTIN>'
;130	:	Write File Line : 	'	      <PLACEOFSUPPLY>'+$LedStateName:Ledger:$supplier_name+'</PLACEOFSUPPLY>'
;140	:	Write File Line : 	'	      <PARTYNAME>'+$supplier_name+'</PARTYNAME>'
;150	:	Write File Line : 	'	      <PARTYLEDGERNAME>'+$supplier_name+'</PARTYLEDGERNAME>'
;160	:	Write File Line : 	'	      <VOUCHERTYPENAME>'+@@PIVoucherType+'</VOUCHERTYPENAME>'
;170	:	Write File Line : 	'	      <PARTYMAILINGNAME>'+$supplier_name+'</PARTYMAILINGNAME>'
;180	:	Write File Line : 	'	      <CONSIGNEEMAILINGNAME>GEO - Andhrapradesh</CONSIGNEEMAILINGNAME>'
;190	:	Write File Line : 	'	      <CONSIGNEESTATENAME>'+$LedStateName:Ledger:$supplier_name+'</CONSIGNEESTATENAME>'
;200	:	Write File Line : 	'	      <VOUCHERNUMBER>'+$name+'</VOUCHERNUMBER>'
;210	:	Write File Line : 	'	      <BASICBASEPARTYNAME>'+$supplier_name+'</BASICBASEPARTYNAME>'
;220	:	Write File Line : 	'	      <FBTPAYMENTTYPE>Default</FBTPAYMENTTYPE>'
;230	:	Write File Line : 	'	      <PERSISTEDVIEW>Invoice Voucher View</PERSISTEDVIEW>'
;240	:	Write File Line : 	'	      <BASICBUYERNAME>'+@@CmpMailName+'</BASICBUYERNAME>'
;250	:	Write File Line : 	'	      <CONSIGNEECOUNTRYNAME>'+$CountryName:Company:##SVCurrentCompany+'</CONSIGNEECOUNTRYNAME>'
;260	:	Write File Line : 	'	      <VCHENTRYMODE>Item Invoice</VCHENTRYMODE>'
;270	:	Write File Line : 	'	      <EFFECTIVEDATE>'+$$GetTallyDate:$posting_date+'</EFFECTIVEDATE>'
;280	:	Write File Line : 	'	      <ISINVOICE>Yes</ISINVOICE>'
;282	:	Write File Line : 	'	      <ISVATDUTYPAID>Yes</ISVATDUTYPAID>'
;285 : Walk Collection: tSalesinvoice
;286 : Walk Collection: items
;288 : Do If: ($$IsEmpty:$Name:StockItem:$item_code) : Call: CreateItems:$item_code:$item_group:$uom
;290 : Do If: ($$IsEmpty:$Name:Godown:$warehouse) : Call: CreateWarehouse:$warehouse
;
;300	:	Write File Line : 	'	      <ALLINVENTORYENTRIES.LIST>'
;310	:	Write File Line : 	'	       <STOCKITEMNAME>'+$item_code+'</STOCKITEMNAME>'
;320	:	Write File Line : 	'	       <ISDEEMEDPOSITIVE>'+@@PIDeemedPos+'</ISDEEMEDPOSITIVE>'
;340	:	Write File Line : 	'	       <RATE>'+$$String:$rate+'/'+$uom+'</RATE>'
;350	:	Write File Line : 	'	       <AMOUNT>'+@@PIAmount+'</AMOUNT>'
;360	:	Write File Line : 	'	       <ACTUALQTY> '+$$String:$qty+' '+$uom+'</ACTUALQTY>'
;370	:	Write File Line : 	'	       <BILLEDQTY> '+$$String:$qty+' '+$uom+'</BILLEDQTY>'
;380	:	Write File Line : 	'	       <BATCHALLOCATIONS.LIST>'
;390	:	Write File Line : 	'	        <GODOWNNAME>'+$warehouse+'</GODOWNNAME>'
;400	:	Write File Line : 	'	        <BATCHNAME>Primary Batch</BATCHNAME>'
;410	:	Write File Line : 	'	        <AMOUNT>-'+@@PIAmount+'</AMOUNT>'
;420	:	Write File Line : 	'	        <ACTUALQTY> '+$$String:$qty+' '+$uom+'</ACTUALQTY>'
;430	:	Write File Line : 	'	        <BILLEDQTY> '+$$String:$qty+' '+$uom+'</BILLEDQTY>'
;440	:	Write File Line : 	'	       </BATCHALLOCATIONS.LIST>'
;450	:	Write File Line : 	'	       <ACCOUNTINGALLOCATIONS.LIST>'
;460	:	Write File Line : 	'	        <LEDGERNAME>GST Sales</LEDGERNAME>'
;470	:	Write File Line : 	'	        <ISDEEMEDPOSITIVE>'+@@PIDeemedPos+'</ISDEEMEDPOSITIVE>'
;480	:	Write File Line : 	'	        <AMOUNT>'+@@PIAmount+'</AMOUNT>'
;490	:	Write File Line : 	'	       </ACCOUNTINGALLOCATIONS.LIST>'
;500	:	Write File Line : 	'	      </ALLINVENTORYENTRIES.LIST>'
;502 : End Walk
;503 : End Walk
;
;
;510	:	Write File Line : 	'	      <LEDGERENTRIES.LIST>'
;520	:	Write File Line : 	'	       <LEDGERNAME>'+$supplier_name+'</LEDGERNAME>'
;530	:	Write File Line : 	'	       <ISDEEMEDPOSITIVE>'+@@PIDeemedPosNo+'</ISDEEMEDPOSITIVE>'
;540	:	Write File Line : 	'	       <ISPARTYLEDGER>Yes</ISPARTYLEDGER>'
;550	:	Write File Line : 	'	       <AMOUNT>'+@@PIPartyAmount+'</AMOUNT>'
;560	:	Write File Line : 	'	       <BILLALLOCATIONS.LIST>'
;570	:	Write File Line : 	'	        <NAME>'+$name+'</NAME>'
;580	:	Write File Line : 	'	        <BILLTYPE>New Ref</BILLTYPE>'
;590	:	Write File Line : 	'	        <AMOUNT>'+@@PIPartyAmount+'</AMOUNT>'
;600	:	Write File Line : 	'	       </BILLALLOCATIONS.LIST>'
;610	:	Write File Line : 	'	      </LEDGERENTRIES.LIST>'
;
;612 : Walk Collection: tSalesinvoice
;614 : Walk Collection: taxes
;
;615 : Do If: ($$IsEmpty:$name:Ledger:$account_head) : Call: CreateAccountHead:$account_head
;620	:	Write File Line : 	'	      <LEDGERENTRIES.LIST>'
;630	:	Write File Line : 	'	       <LEDGERNAME>'+$account_head+'</LEDGERNAME>'
;640	:	Write File Line : 	'	       <ISDEEMEDPOSITIVE>'+@@PIDeemedPos+'</ISDEEMEDPOSITIVE>'
;650	:	Write File Line : 	'	       <AMOUNT>'+@@PITaxAMount+'</AMOUNT>'
;660	:	Write File Line : 	'	       <VATEXPAMOUNT>'+@@PITaxAMount+'</VATEXPAMOUNT>'
;670	:	Write File Line : 	'	      </LEDGERENTRIES.LIST>'
;
;675 : End Walk
;678 : End Walk
;
;
;;740	:	Write File Line : 	'	      <LEDGERENTRIES.LIST>'
;;750	:	Write File Line : 	'	       <LEDGERNAME>Round Off</LEDGERNAME>'
;;760	:	Write File Line : 	'	       <ISDEEMEDPOSITIVE>Yes</ISDEEMEDPOSITIVE>'
;;770	:	Write File Line : 	'	       <AMOUNT>'++'</AMOUNT>'
;;780	:	Write File Line : 	'	       <VATEXPAMOUNT>'++'</VATEXPAMOUNT>'
;;790	:	Write File Line : 	'	      </LEDGERENTRIES.LIST>'
;
;800	:	Write File Line : 	'	     </VOUCHER>'
;810	:	Write File Line : 	'	    </TALLYMESSAGE>'
;
;
;[System : Formula]
;
;	PIVoucherType 	: if ##is_return = 0 then "ERPNext-Sales" else "ERPNext-Debit Note"
;	PIDeemedPos 	: if ##is_return = 0 then "Yes" else "No"
;	PIDeemedPosNo	: if ##is_return = 0 then "No" else "Yes"
;	PIAmount	: if ##is_return = 0 then '-'+$$String:$amount else $$String:$amount
;	PIPartyAmount	: if ##is_return = 0 then $$String:$base_rounded_total else '-'+$$String:$base_rounded_total
;	PITaxAMount	: if ##is_return = 0 then '-'+$$String:$tax_amount_after_discount_amount else $$String:$tax_amount_after_discount_amount
;	
;
;
;[Function: CreateAccountHead]
;	
;	Parameter: vName : String
;
;	10 : New Object: Ledger
;	20 : 	Set Value: NAme : ##vName
;	30 : 	Set Value: Parent : "Duties and Taxes"
;	40 : Create Target
;	
;
;[Function: CreateItems]
;	
;	Parameter: vName : String
;	Parameter: vGroup : String
;	Parameter: vUnits : String
;	
;	08 : Do If: ($$IsEmpty:$Name:StockGroup:##vGroup) : Call: CreateStockGroup:##vGroup
;	09 : Do If: ($$IsEmpty:$Name:Unit:##vUnits) : Call: CreateUnits:##vUnits
;
;	10 : New Object: StockItem 
;	20 : 	Set Value: Name 	: ##vName
;	30 : 	Set Value: Parent 	: ##vGroup
;	40 : 	Set Value: BaseUnits : ##vUnits
;	50 : Create Target
;
;
;
;[Function: CreateStockGroup]
;		
;	Parameter: vGroup : String
;	
;	10 : New Object: StockGroup
;	20 : 	Set Value: Name : ##vGroup 
;	30 : Create Target
;
;	
;	
;[Function: CreateUnits]
;
;	Parameter : vUnit : String
;
;	10 : New Object: Unit
;	30 : 	Set Value: Name : ##vUnit
;	40 : 	Set Value: ASORIGINAL : Yes
;	50 : 	Set Value: ISSIMPLEUNIT : Yes
;	60 : Create Target
;	
;
;[Function: CreateWarehouse]
;
;	Parameter : vName : String
;
;	10 : New Object: Godown
;	30 : 	Set Value: Name : ##vName
;	40 : 	Set Value: ASORIGINAL : Yes
;	60 : Create Target
;
;
;
;
