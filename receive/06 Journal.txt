;;;Shivgoraksh
;
;[Variable: JournalLV]
;	
;	Type: String
;
;[#Menu: ERPNextMenu]
;	
;	Add: Item: ERPNextJournal  : Call: ERPNextJournal
;	
;	[Function: ERPNextJournal]
;		
;		List Variable: JournalLV
;
;		12 : Delete File: "STJournal.xml"
;		13 : Open File: "STJournal.xml" : Text : Write
;		14 : Truncate File
;
;		16 : Walk Collection: ERPNextJournalColl
;		18 : Call: JournalXML
;		152 : List Add: JournalLV : $name : $name		
;		155 : End Walk
;
;		200 : Close Target File
;		210 : SET : IMPORT File : "STJournal.xml" 	
;		220 : Import : Vouchers : Yes
;
;;		230 : If : Not $$ImportInfo:Errors > 0		
;;		240 : 	Call : UpdateJournalStatus:($$NumItems:JournalLVColl)
;;		242 : else
;;		245 : Msg Box: "Error" : "Something Went Wrong, Please contact support"
;;		250 : End If
;
;		
;[Collection: ERPNextJournalColl]
;	
;	Export Header	: "Accept: application/json"
;	Export Header	: "Accept-Charset: utf-8"
;	Export Header	: "Authorization: " + "token " + @@AuthToken
;
;	Data Source		: HTTP JSON : @@ERPNextHost + '/api/method/tally_integration.tally.journal'
;	RemoteRequest	: JournalReq : UTF8
;	JSON Object 	: ERPNextJournal
;	JSON Object Path: "message:1"
;	
;
;	[Object: ERPNextJournal]
;
;		Storage : name 			: String
;		Storage : party			: String
;		Storage : party_name	: String
;		Storage : posting_date  : String
;		Storage : paid_from		: String
;		Storage : paid_to 		: String
;		Storage : paid_amount 	: Number
;		Storage : remarks 		: String
;		Storage : Journal_type 	: String
;		
;		collection : treferences : treferences
;		
;		[Object: treferences]
;			
;			Collection: references : references
;			
;		[Object: references]
;			
;			Storage: allocated_amount 	: Number
;			Storage: reference_name 	: String
;;
;;		[Object: taxes]
;;			
;;			Storage: account_head	: String
;;			Storage: tax_amount_after_discount_amount : Number
;
;;; Request Report 
;
;	[Report: JournalReq]
;		
;		Form: JournalReq
;		
;		[Form: JournalReq]
;			
;			Part: JournalReq
;			Delete: XMLTag
;
;			[Part: JournalReq]
;					
;				Line: JournalReq
;				Scroll: Vertical
;
;				[Line: JournalReq]
;					
;					Field: JournalReqBranch, JournalReqSyncFrom
;					;XMLTag: "request"
;					
;				[Field: JournalReqBranch]
;					
;					XMLTag: "branch"
;					Set as: @@ERPNextBranch
;					
;				[Field: JournalReqSyncFrom]
;					
;					XMLTag: "date"
;					Set as: "2021-04-01" ; @@ERPNextLastSyncOn
;					
;;; End of Request Report
;
;
;
;;; Master Success 
;
;[Function: UpdateJournalStatus]
;	
;	Parameter: processedIds : Number
;
;	08 : If: ##processedIds > 0 
;	10 : Walk Collection: UpdateJournalColl
;	20 : End Walk
;	30 : End If
;	40 : Delete File: "STJournal.xml"
;
;
;
;
;[Collection: UpdateJournalColl]
;	
;	Export Header	: "Accept: application/json"
;	Export Header	: "Accept-Charset: utf-8"
;	Export Header	: "Authorization: " + "token " + @@AuthToken
;
;	Data Source	 : HTTP JSON: @@ERPNextHost + '/api/method/tally_integration.tally.customer_update'
;	RemoteRequest : UpdateJournalRep : UTF8
;
;;; Status Report 
;
;[Report: UpdateJournalRep]
;	
;	Form: UpdateJournalRep
;	
;	[Form: UpdateJournalRep]
;		
;		Part: UpdateJournalRep
;		Delete: XMLTag
;
;	[Part: UpdateJournalRep]
;		
;		Line: UpdateJournalRep
;		Scroll: Vertical
;		
;	[Line: UpdateJournalRep]
;		
;		Field: UpdateJournalRep
;		Explode: UpdateJournalRepExp
;		
;			[Part: UpdateJournalRepExp]
;				
;				Line: UpdateJournalRepExp
;				Repeat: UpdateJournalRepExp : JournalLVColl
;				
;				[Line: UpdateJournalRepExp]
;					
;					Field: UpdateJournalRepExp
;					JSONTag: "data"
;					
;					[Field:UpdateJournalRepExp]
;						
;						Set as: $JournalLV
;						XMLTag: "docname"
;		
;		[Field: UpdateJournalRep]
;			
;			Set as: "Journal Entry"
;			JSONTag: "request_type"
;	
;	[Collection: JournalLVColl]
;		
;		Data Source: Variable: JournalLV 
;
;;;;; Purchase XMl
;
;[Function: JournalXML]
;
;Variable: Journal_type  : String : $Journal_type
;
;	10 : Do If: ##Journal_type  = "Pay" : Call: XMLJournal
;	20 : Do If: ##Journal_type  = "Receive" : Call: XMLReceipt
;
;[Function: XMLJournal]
;	
;10		: Write File Line 	:'	    <TALLYMESSAGE xmlns:UDF="TallyUDF">'
;15		: Write File Line 	:'	     <VOUCHER REMOTEID="'+$name+'" VCHTYPE="'+@@PEVouchertype+'" ACTION="Create" OBJVIEW="Accounting Voucher View">'
;20		: Write File Line 	:'	      <DATE>'+$$GetTallyDate:$posting_date+'</DATE>'
;25		: Write File Line 	:'	      <NARRATION>'+$remarks+'</NARRATION>'
;30		: Write File Line 	:'	      <PARTYLEDGERNAME>'+$paid_from+'</PARTYLEDGERNAME>'
;35		: Write File Line 	:'	      <VOUCHERTYPENAME>'+@@PEVouchertype+'</VOUCHERTYPENAME>'
;40		: Write File Line 	:'	      <VOUCHERNUMBER>'+$name+'</VOUCHERNUMBER>'
;45		: Write File Line 	:'	      <PERSISTEDVIEW>Accounting Voucher View</PERSISTEDVIEW>'
;50		: Write File Line 	:'	      <EFFECTIVEDATE>'+$$GetTallyDate:$posting_date+'</EFFECTIVEDATE>'
;55		: Write File Line 	:'	      <HASCASHFLOW>Yes</HASCASHFLOW>'
;60		: Write File Line 	:'	      <ISVATDUTYPAID>Yes</ISVATDUTYPAID>'
;65		: Write File Line 	:'	      <ALLLEDGERENTRIES.LIST>'
;70		: Write File Line 	:'	       <LEDGERNAME>'+$paid_to+'</LEDGERNAME>'
;75		: Write File Line 	:'	       <ISDEEMEDPOSITIVE>Yes</ISDEEMEDPOSITIVE>'
;80		: Write File Line 	:'	       <ISPARTYLEDGER>Yes</ISPARTYLEDGER>'
;85		: Write File Line 	:'	       <ISLASTDEEMEDPOSITIVE>Yes</ISLASTDEEMEDPOSITIVE>'
;90		: Write File Line 	:'	       <AMOUNT>'+@@PEPartyAmount+'</AMOUNT>'
;95		: Write File Line 	:'	       <VATEXPAMOUNT>'+@@PEPartyAmount+'</VATEXPAMOUNT>'
;96		: Walk Collection: treferences
;98		: Walk Collection: references
;;99 : Log: $reference_name
;100		: Write File Line 	:'	       <BILLALLOCATIONS.LIST>'
;105		: Write File Line 	:'	        <NAME>'+$$String:$reference_name+'</NAME>'
;110		: Write File Line 	:'	        <BILLTYPE>New Ref</BILLTYPE>'
;115		: Write File Line 	:'	        <AMOUNT>'+$$String:@@PEAllocAmount+'</AMOUNT>'
;120		: Write File Line 	:'	       </BILLALLOCATIONS.LIST>'
;121		: End Walk
;122		: End Walk
;125		: Write File Line 	:'	      </ALLLEDGERENTRIES.LIST>'
;130		: Write File Line 	:'	      <ALLLEDGERENTRIES.LIST>'
;135		: Write File Line 	:'	       <LEDGERNAME>'+$paid_from+'</LEDGERNAME>'
;140		: Write File Line 	:'	       <ISDEEMEDPOSITIVE>No</ISDEEMEDPOSITIVE>'
;145		: Write File Line 	:'	       <ISPARTYLEDGER>Yes</ISPARTYLEDGER>'
;150		: Write File Line 	:'	       <ISLASTDEEMEDPOSITIVE>No</ISLASTDEEMEDPOSITIVE>'
;155		: Write File Line 	:'	       <AMOUNT>'+@@PECashAmount+'</AMOUNT>'
;160		: Write File Line 	:'	       <VATEXPAMOUNT>'+@@PECashAmount+'</VATEXPAMOUNT>'
;;165		: Write File Line 	:'	       <BANKALLOCATIONS.LIST>'
;;170		: Write File Line 	:'	        <DATE>'++'</DATE>'
;;175		: Write File Line 	:'	        <INSTRUMENTDATE>'++'</INSTRUMENTDATE>'
;;180		: Write File Line 	:'	        <NAME>'++'</NAME>'
;;185		: Write File Line 	:'	        <TRANSACTIONTYPE>'++'</TRANSACTIONTYPE>'
;;190		: Write File Line 	:'	        <IFSCODE>'++'</IFSCODE>'
;;195		: Write File Line 	:'	        <BANKNAME>'++'</BANKNAME>'
;;200		: Write File Line 	:'	        <ACCOUNTNUMBER>'++'</ACCOUNTNUMBER>'
;;205		: Write File Line 	:'	        <JournalFAVOURING>'++'</JournalFAVOURING>'
;;210		: Write File Line 	:'	        <TRANSFERMODE>'++'</TRANSFERMODE>'
;;215		: Write File Line 	:'	        <BANKID>'++'</BANKID>'
;;220		: Write File Line 	:'	        <INSTRUMENTNUMBER>'++'</INSTRUMENTNUMBER>'
;;225		: Write File Line 	:'	        <UNIQUEREFERENCENUMBER>'++'</UNIQUEREFERENCENUMBER>'
;;230		: Write File Line 	:'	        <STATUS>No</STATUS>'
;;235		: Write File Line 	:'	        <JournalMODE>Transacted</JournalMODE>'
;;240		: Write File Line 	:'	        <BANKPARTYNAME>'++'</BANKPARTYNAME>'
;;245		: Write File Line 	:'	        <AMOUNT>'++'</AMOUNT>'
;;250		: Write File Line 	:'	       </BANKALLOCATIONS.LIST>'
;255		: Write File Line 	:'	      </ALLLEDGERENTRIES.LIST>'
;260		: Write File Line 	:'	     </VOUCHER>'
;265		: Write File Line 	:'	    </TALLYMESSAGE>'
;
;
;[Function: XMLReceipt]
;
;10		: Write File Line 	:'	    <TALLYMESSAGE xmlns:UDF="TallyUDF">'
;15		: Write File Line 	:'	     <VOUCHER REMOTEID="'+$name+'" VCHTYPE="'+@@PEVouchertype+'" ACTION="Create" OBJVIEW="Accounting Voucher View">'
;20		: Write File Line 	:'	      <DATE>'+$$GetTallyDate:$posting_date+'</DATE>'
;25		: Write File Line 	:'	      <NARRATION>'+$remarks+'</NARRATION>'
;30		: Write File Line 	:'	      <PARTYLEDGERNAME>'+$paid_from+'</PARTYLEDGERNAME>'
;35		: Write File Line 	:'	      <VOUCHERTYPENAME>'+@@PEVouchertype+'</VOUCHERTYPENAME>'
;40		: Write File Line 	:'	      <VOUCHERNUMBER>'+$name+'</VOUCHERNUMBER>'
;45		: Write File Line 	:'	      <PERSISTEDVIEW>Accounting Voucher View</PERSISTEDVIEW>'
;50		: Write File Line 	:'	      <EFFECTIVEDATE>'+$$GetTallyDate:$posting_date+'</EFFECTIVEDATE>'
;55		: Write File Line 	:'	      <HASCASHFLOW>Yes</HASCASHFLOW>'
;60		: Write File Line 	:'	      <ISVATDUTYPAID>Yes</ISVATDUTYPAID>'
;65		: Write File Line 	:'	      <ALLLEDGERENTRIES.LIST>'
;70		: Write File Line 	:'	       <LEDGERNAME>'+$paid_from+'</LEDGERNAME>'
;75		: Write File Line 	:'	       <ISDEEMEDPOSITIVE>No</ISDEEMEDPOSITIVE>'
;80		: Write File Line 	:'	       <ISPARTYLEDGER>Yes</ISPARTYLEDGER>'
;85		: Write File Line 	:'	       <ISLASTDEEMEDPOSITIVE>No</ISLASTDEEMEDPOSITIVE>'
;90		: Write File Line 	:'	       <AMOUNT>'+@@PEPartyAmount+'</AMOUNT>'
;95		: Write File Line 	:'	       <VATEXPAMOUNT>'+@@PEPartyAmount+'</VATEXPAMOUNT>'
;96		: Walk Collection: treferences
;98		: Walk Collection: references
;100		: Write File Line 	:'	       <BILLALLOCATIONS.LIST>'
;105		: Write File Line 	:'	        <NAME>'+$$String:$reference_name+'</NAME>'
;110		: Write File Line 	:'	        <BILLTYPE>New Ref</BILLTYPE>'
;115		: Write File Line 	:'	        <AMOUNT>'+$$String:$allocated_amount+'</AMOUNT>'
;120		: Write File Line 	:'	       </BILLALLOCATIONS.LIST>'
;121		: End Walk
;122		: End Walk
;125		: Write File Line 	:'	      </ALLLEDGERENTRIES.LIST>'
;130		: Write File Line 	:'	      <ALLLEDGERENTRIES.LIST>'
;135		: Write File Line 	:'	       <LEDGERNAME>'+$paid_to+'</LEDGERNAME>'
;140		: Write File Line 	:'	       <ISDEEMEDPOSITIVE>Yes</ISDEEMEDPOSITIVE>'
;145		: Write File Line 	:'	       <ISPARTYLEDGER>Yes</ISPARTYLEDGER>'
;150		: Write File Line 	:'	       <ISLASTDEEMEDPOSITIVE>Yes</ISLASTDEEMEDPOSITIVE>'
;155		: Write File Line 	:'	       <AMOUNT>'+@@PECashAmount+'</AMOUNT>'
;160		: Write File Line 	:'	       <VATEXPAMOUNT>'+@@PECashAmount+'</VATEXPAMOUNT>'
;;165		: Write File Line 	:'	       <BANKALLOCATIONS.LIST>'
;;170		: Write File Line 	:'	        <DATE>'++'</DATE>'
;;175		: Write File Line 	:'	        <INSTRUMENTDATE>'++'</INSTRUMENTDATE>'
;;180		: Write File Line 	:'	        <NAME>'++'</NAME>'
;;185		: Write File Line 	:'	        <TRANSACTIONTYPE>'++'</TRANSACTIONTYPE>'
;;190		: Write File Line 	:'	        <IFSCODE>'++'</IFSCODE>'
;;195		: Write File Line 	:'	        <BANKNAME>'++'</BANKNAME>'
;;200		: Write File Line 	:'	        <ACCOUNTNUMBER>'++'</ACCOUNTNUMBER>'
;;205		: Write File Line 	:'	        <JournalFAVOURING>'++'</JournalFAVOURING>'
;;210		: Write File Line 	:'	        <TRANSFERMODE>'++'</TRANSFERMODE>'
;;215		: Write File Line 	:'	        <BANKID>'++'</BANKID>'
;;220		: Write File Line 	:'	        <INSTRUMENTNUMBER>'++'</INSTRUMENTNUMBER>'
;;225		: Write File Line 	:'	        <UNIQUEREFERENCENUMBER>'++'</UNIQUEREFERENCENUMBER>'
;;230		: Write File Line 	:'	        <STATUS>No</STATUS>'
;;235		: Write File Line 	:'	        <JournalMODE>Transacted</JournalMODE>'
;;240		: Write File Line 	:'	        <BANKPARTYNAME>'++'</BANKPARTYNAME>'
;;245		: Write File Line 	:'	        <AMOUNT>'++'</AMOUNT>'
;;250		: Write File Line 	:'	       </BANKALLOCATIONS.LIST>'
;255		: Write File Line 	:'	      </ALLLEDGERENTRIES.LIST>'
;260		: Write File Line 	:'	     </VOUCHER>'
;265		: Write File Line 	:'	    </TALLYMESSAGE>'
;
;
;[System : Formula]
;
;	PEVoucherType 	: if ##Journal_type = "Pay" then $$GEOPymtVchType else $$GEORcptVchType
;	
;	PEPartyAmount	: if ##Journal_type = "Pay" then '-'+$$String:@@PEAbsPartyAmount else $$String:@@PEAbsPartyAmount
;	PEAbsPartyAmount	: $$Abs:$paid_amount
;	
;	PEAllocAmount	: if ##Journal_type = "Pay" then '-'+$$String:@@PEAbsAllocAmount else $$String:@@PEAbsAllocAmount
;	PEAbsAllocAmount	: $$Abs:$allocated_amount
;
;	PECashAmount	: if ##Journal_type = "Pay" then $$String:@@PEAbsCashAmount else '-'+$$String:@@PEAbsCashAmount
;	PEAbsCashAmount	: $$Abs:$paid_amount
